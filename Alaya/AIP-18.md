---
AIP: 18
Topic: 委托锁定
Author: clearly
Status: Draft 
Type: Upgrade
Description: 支持委托锁定
Created: 2021-07-12
---

# AIP-18：关于支持委托锁定的提案

## 背景
Alaya网络上目前ATP持有者委托验证人节点是很灵活的，可以随时取消委托换其他人， 除了解委托的结算周期内（约3个小时）获取不到委托收益外不会有其他的损失， 这样会存在以下问题：

1. 公平性问题
对于节点来说，解除质押有锁定期，锁定期内限制流通，而委托没有限制的话对于质押节点来说是不太公平的，这样会影响质押节点的积极性，节点不愿意通过增加质押来获得收益而更愿意用来委托

2. 流通导致的安全问题
我们都知道对于PoS机制的公链来说Staking比例越高网络越安全，如果参与维护网络稳定的验证人节点都不愿意Staking，而把大部分Token用来委托，这样就极大增加了Token流通，给网络带来潜在的危险，举个简单的例子，恶意节点可以通过大量获得流动的Token，质押多个节点（超过2/3）来达到控制网络的目的


## 目的
对解除委托增加委托金锁定机制，限制用户随意解委托。对于愿意在解除委托时将委托金锁定一定周期的委托人，会得到更多的委托奖励。

## 内容

### 委托锁定流程
原委托流程不变，增加支持锁定功能的委托，流程如下：
![委托锁定](./images/委托锁定-ch.png "委托锁定流程")

支持锁定功能的委托有四个生命周期：

- 犹豫期

  用户发起委托时的结算周期为犹豫期，处于犹豫期的委托可以发起撤销委托操作，委托金会即时退回给委托人。

- 生效期

  犹豫期过后的结算周期为生效期，该周期内委托正式生效，可领取委托奖励。用户如在生效期间发起撤销委托操作,当前结算周期委托收益保留,在下一个结算周期进入锁定期。

- 锁定期

  委托金在撤销后需要被锁定168个结算周期，从用户发起撤销委托操作后的下个结算周期开始计算。委托金被锁定后无法产生收益,该金额可以被用来对任意节点发起锁定委托,下个结算周期生效。若在委托生效前撤销委托，在当前结算周期基础上锁定168个结算周期。

- 解锁期

  锁定期过后的委托金需要用户主动领取，此期间为解锁期。


  注:
   1. 锁定期的委托金只能用来进行锁定委托,优先使用释放周期长的委托金.
   2. 撤销委托时,原有的普通委托的撤销流程不变,加入锁定委托的撤销流程:
     - 先撤销犹豫期的委托金,后撤销生效期的委托金.
     - 对于犹豫期的委托金,优先撤销普通委托的委托金,后撤销锁定委托的委托金.
     - 对于生效期的委托金,优先撤销普通委托的委托金,后撤销锁定委托的委托金.
     - 撤销锁定委托金时,优先撤销来自余额的部分,后撤销来自锁仓计划的部分.


### 委托的收益更改

支持锁定功能的委托金，承担了风险，理应获得更高的收益。因此奖励部分做出如下修改：

- 支持委托锁定功能的委托金可以获得出块奖励与质押奖励

- 不支持委托锁定功能的委托金仅能获得质押奖励








